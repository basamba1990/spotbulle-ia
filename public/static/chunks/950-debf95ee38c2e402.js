"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[950],{2950:function(e,r,t){t.d(r,{AuthProvider:function(){return p},a:function(){return d}});var o=t(7437),n=t(2265),s=t(4131),a=t(5864);let i={LOGIN_START:"LOGIN_START",LOGIN_SUCCESS:"LOGIN_SUCCESS",LOGIN_ERROR:"LOGIN_ERROR",LOGOUT:"LOGOUT",REGISTER_START:"REGISTER_START",REGISTER_SUCCESS:"REGISTER_SUCCESS",REGISTER_ERROR:"REGISTER_ERROR",LOAD_USER_START:"LOAD_USER_START",LOAD_USER_SUCCESS:"LOAD_USER_SUCCESS",LOAD_USER_ERROR:"LOAD_USER_ERROR",UPDATE_USER:"UPDATE_USER",CLEAR_ERROR:"CLEAR_ERROR"},u={user:null,token:null,isAuthenticated:!1,isLoading:!0,error:null},l=(e,r)=>{switch(r.type){case i.LOGIN_START:case i.REGISTER_START:case i.LOAD_USER_START:return{...e,isLoading:!0,error:null};case i.LOGIN_SUCCESS:case i.REGISTER_SUCCESS:return{...e,user:r.payload.user,token:r.payload.token,isAuthenticated:!0,isLoading:!1,error:null};case i.LOAD_USER_SUCCESS:return{...e,user:r.payload.user,isAuthenticated:!0,isLoading:!1,error:null};case i.LOGIN_ERROR:case i.REGISTER_ERROR:case i.LOAD_USER_ERROR:return{...e,user:null,token:null,isAuthenticated:!1,isLoading:!1,error:r.payload};case i.LOGOUT:return{...e,user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null};case i.UPDATE_USER:return{...e,user:{...e.user,...r.payload},isLoading:!1,error:null};case i.CLEAR_ERROR:return{...e,error:null};default:return e}},c=(0,n.createContext)(),d=()=>{let e=(0,n.useContext)(c);if(!e)throw Error("useAuth doit \xeatre utilis\xe9 dans un AuthProvider");return e},p=e=>{let{children:r}=e,[t,d]=(0,n.useReducer)(l,u);(0,n.useEffect)(()=>{p()},[]),(0,n.useEffect)(()=>{t.token?s.Z.set("auth-token",t.token,{expires:7}):s.Z.remove("auth-token")},[t.token]);let p=async()=>{if(!s.Z.get("auth-token")){d({type:i.LOAD_USER_ERROR,payload:null});return}d({type:i.LOAD_USER_START});try{let e=await a.kv.me();d({type:i.LOAD_USER_SUCCESS,payload:{user:e.data.data.user}})}catch(e){console.error("Erreur lors du chargement de l'utilisateur:",e),d({type:i.LOAD_USER_ERROR,payload:"Session expir\xe9e, veuillez vous reconnecter"}),s.Z.remove("auth-token")}},R=async e=>{var r,t;d({type:i.LOGIN_START});try{let t=await a.kv.login(e);if(t.data&&t.data.success)return d({type:i.LOGIN_SUCCESS,payload:{user:t.data.data.user,token:t.data.data.token}}),{success:!0};{let e=(null===(r=t.data)||void 0===r?void 0:r.message)||"Erreur de connexion";return d({type:i.LOGIN_ERROR,payload:e}),{success:!1,error:e}}}catch(r){console.error("Erreur de connexion:",r);let e="Erreur de connexion au serveur";if(r.response){let o=r.response.status,n=null===(t=r.response.data)||void 0===t?void 0:t.message;e=401===o?n||"Email ou mot de passe incorrect":403===o?n||"Compte inactif ou suspendu":500===o?"Erreur interne du serveur. Veuillez r\xe9essayer plus tard.":o>=400&&o<500?n||"Donn\xe9es invalides":n||"Erreur de connexion"}else e=r.request?"Impossible de contacter le serveur. V\xe9rifiez votre connexion internet.":r.message||"Erreur de connexion";return d({type:i.LOGIN_ERROR,payload:e}),{success:!1,error:e}}},E=async e=>{var r,t,o;d({type:i.REGISTER_START});try{let t=await a.kv.register(e);if(t.data&&t.data.success)return d({type:i.REGISTER_SUCCESS,payload:{user:t.data.data.user,token:t.data.data.token}}),{success:!0};{let e=(null===(r=t.data)||void 0===r?void 0:r.message)||"Erreur d'inscription";return d({type:i.REGISTER_ERROR,payload:e}),{success:!1,error:e}}}catch(r){console.error("Erreur d'inscription:",r);let e="Erreur lors de l'inscription";if(r.response){let n=r.response.status,s=null===(t=r.response.data)||void 0===t?void 0:t.message,a=null===(o=r.response.data)||void 0===o?void 0:o.errors;e=409===n?s||"Un utilisateur avec cet email existe d\xe9j\xe0":400===n?a&&a.length>0?a.map(e=>e.msg).join(", "):s||"Donn\xe9es invalides":500===n?"Erreur interne du serveur. Veuillez r\xe9essayer plus tard.":s||"Erreur lors de l'inscription"}else e=r.request?"Impossible de contacter le serveur. V\xe9rifiez votre connexion internet.":r.message||"Erreur lors de l'inscription";return d({type:i.REGISTER_ERROR,payload:e}),{success:!1,error:e}}},v={...t,login:R,register:E,logout:()=>{d({type:i.LOGOUT}),s.Z.remove("auth-token")},updateUser:e=>{d({type:i.UPDATE_USER,payload:e})},clearError:()=>{d({type:i.CLEAR_ERROR})},loadUser:p};return(0,o.jsx)(c.Provider,{value:v,children:r})}},5864:function(e,r,t){t.d(r,{K2:function(){return c},TV:function(){return u},kv:function(){return i},rb:function(){return d},uB:function(){return l}});var o=t(3464),n=t(4131);let s="https://spotbulle-ia.onrender.com",a=o.Z.create({baseURL:s,timeout:3e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let r=n.Z.get("auth-token");return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{if(e.response){let{status:r,data:t}=e.response,o=t.message||"Erreur ".concat(r," du serveur");switch(r){case 400:o=t.message||"Requ\xeate invalide.";break;case 401:o=t.message||"Session expir\xe9e ou non autoris\xe9e.",!e.config.url||e.config.url.includes("/api/auth/login")||e.config.url.includes("/api/auth/register")||e.config.url.includes("/api/auth/me")||e.config.url.includes("/ia/recommandations")||(window.location.href="/login");break;case 403:o=t.message||"Acc\xe8s refus\xe9.";break;case 404:o=t.message||"Ressource non trouv\xe9e.";break;case 500:o=t.message||"Erreur interne du serveur. Veuillez r\xe9essayer plus tard.";break;default:o=t.message||"Une erreur inattendue est survenue (Code: ".concat(r,").")}console.error("Erreur API (".concat(r,"):"),o,t.errors)}else e.request?console.error("Erreur r\xe9seau: Aucune r\xe9ponse re\xe7ue.",e.message):console.error("Erreur de configuration de la requ\xeate:",e.message);return Promise.reject(e)});let i={register:e=>a.post("/api/auth/register",e),login:e=>a.post("/api/auth/login",e),logout:()=>a.post("/api/auth/logout"),me:()=>a.get("/api/auth/me"),refreshToken:()=>a.post("/api/auth/refresh-token")},u={getProfile:e=>a.get("/api/users/".concat(e)),updateProfile:e=>a.put("/api/users/profile",e),getUserVideos:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.get("/api/users/".concat(e,"/videos"),{params:r})},getUserStats:e=>a.get("/api/users/".concat(e,"/stats")),searchUsers:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/api/users/search",{params:e})}},l={getEvents:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/api/events",{params:e})},getEventById:e=>a.get("/api/events/".concat(e)),createEvent:e=>a.post("/api/events",e),updateEvent:(e,r)=>a.put("/api/events/".concat(e),r),deleteEvent:e=>a.delete("/api/events/".concat(e)),getEventVideos:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.get("/api/events/".concat(e,"/videos"),{params:r})},joinEvent:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.post("/api/events/".concat(e,"/join"),r)}},c={getVideos:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/api/videos",{params:e})},getVideoById:e=>a.get("/api/videos/".concat(e)),uploadVideo:e=>a.post("/api/videos/upload",e,{headers:{"Content-Type":"multipart/form-data"},timeout:3e5}),updateVideo:(e,r)=>a.put("/api/videos/".concat(e),r),deleteVideo:e=>a.delete("/api/videos/".concat(e)),toggleLike:(e,r)=>a.post("/api/videos/".concat(e,"/like"),{action:r})},d={handleError:e=>{if(e.response){var r,t;return{message:(null===(r=e.response.data)||void 0===r?void 0:r.message)||"Erreur serveur",status:e.response.status,errors:(null===(t=e.response.data)||void 0===t?void 0:t.errors)||[]}}return e.request?{message:"Erreur de connexion au serveur",status:0,errors:[]}:{message:e.message||"Erreur inconnue",status:0,errors:[]}},formatPaginationParams:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{page:e,limit:r,...t}},validateVideoFile:e=>{let r=parseInt("104857600")||104857600;if(!("video/mp4,video/avi,video/mov,video/wmv,video/webm".split(",")||["video/mp4","video/avi","video/mov","video/wmv","video/webm"]).includes(e.type))throw Error("Type de fichier non autoris\xe9");if(e.size>r)throw Error("Fichier trop volumineux");return!0},formatImageUrl:e=>e?e.startsWith("http")?e:"".concat(s).concat(e):null,formatDate:e=>new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}),formatDateTime:e=>new Date(e).toLocaleString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),formatDuration:e=>{if(!e)return"0:00";let r=Math.floor(e/3600),t=Math.floor(e%3600/60),o=e%60;return r>0?"".concat(r,":").concat(t.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0")):"".concat(t,":").concat(o.toString().padStart(2,"0"))},formatFileSize:e=>{if(!e)return"0 B";let r=Math.floor(Math.log(e)/Math.log(1024));return"".concat((e/Math.pow(1024,r)).toFixed(1)," ").concat(["B","KB","MB","GB"][r])}}}}]);